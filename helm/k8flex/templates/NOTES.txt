üéâ K8flex AI Debug Agent has been deployed!

üìä Release Information:
  Name:      {{ .Release.Name }}
  Namespace: {{ .Release.Namespace }}
  Version:   {{ .Chart.Version }}

üîç Get the application status:
  kubectl get pods -n {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "k8flex.name" . }},app.kubernetes.io/instance={{ .Release.Name }}"

üìù View logs:
  kubectl logs -n {{ .Release.Namespace }} deployment/{{ include "k8flex.fullname" . }} -f

üåê Service endpoint (internal):
  http://{{ include "k8flex.fullname" . }}.{{ .Release.Namespace }}.svc.cluster.local:{{ .Values.service.port }}/webhook

‚öôÔ∏è  Configuration:
  - Ollama URL: {{ .Values.config.ollama.url }}
  - Ollama Model: {{ .Values.config.ollama.model }}
{{- if or .Values.slack.botToken .Values.slack.webhookUrl }}
  - Slack: ‚úÖ Enabled
  {{- if .Values.slack.botToken }}
  - Threading: ‚úÖ Supported (Bot token)
  {{- else }}
  - Threading: ‚ö†Ô∏è  Not supported (Webhook only)
  {{- end }}
{{- else }}
  - Slack: ‚ö†Ô∏è  Not configured
{{- end }}

üìö Next Steps:

{{- if not (or .Values.slack.botToken .Values.slack.webhookUrl) }}

1. Configure Slack Integration:
   
   For threading support (recommended):
   helm upgrade {{ .Release.Name }} ./helm/k8flex \
     --namespace {{ .Release.Namespace }} \
     --set slack.botToken="xoxb-YOUR-BOT-TOKEN" \
     --set slack.channelId="C01234567890"

   OR use webhook (no threading):
   helm upgrade {{ .Release.Name }} ./helm/k8flex \
     --namespace {{ .Release.Namespace }} \
     --set slack.webhookUrl="https://hooks.slack.com/services/..."

{{- end }}

2. Configure Alertmanager to send webhooks:
   Add this receiver to your Alertmanager configuration:

   üîê First, get your webhook authentication token:
   kubectl get secret {{ include "k8flex.fullname" . }}-secrets -n {{ .Release.Namespace }} -o jsonpath='{.data.WEBHOOK_AUTH_TOKEN}' | base64 -d && echo

   Then configure Alertmanager:
   receivers:
     - name: 'k8flex-ai-debug'
       webhook_configs:
         - url: 'http://{{ include "k8flex.fullname" . }}.{{ .Release.Namespace }}.svc.cluster.local:{{ .Values.service.port }}/webhook'
           send_resolved: false
           http_config:
             authorization:
               credentials: "<PASTE_YOUR_TOKEN_HERE>"

3. Ensure Ollama is deployed:
   kubectl get service ollama -n ollama

4. Test the webhook with authentication:
   TOKEN=$(kubectl get secret {{ include "k8flex.fullname" . }}-secrets -n {{ .Release.Namespace }} -o jsonpath='{.data.WEBHOOK_AUTH_TOKEN}' | base64 -d)
   
   kubectl run test-webhook --rm -i --restart=Never --image=curlimages/curl -- \
     curl -X POST http://{{ include "k8flex.fullname" . }}.{{ .Release.Namespace }}.svc.cluster.local:{{ .Values.service.port }}/webhook \
     -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"alerts":[{"status":"firing","labels":{"alertname":"Test"},"annotations":{"summary":"Test"}}]}'

üìñ Documentation:
   - README: https://github.com/yourorg/k8flex
   - Webhook Security: See WEBHOOK_SECURITY.md
   - Slack Setup: See SLACK_SETUP.md
   - Integration Guide: See INTEGRATION.md

üêõ Troubleshooting:
   kubectl logs -n {{ .Release.Namespace }} deployment/{{ include "k8flex.fullname" . }}
   kubectl describe pod -n {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "k8flex.name" . }}"

Happy debugging! üöÄ
